swagger: '2.0'
info:
  description: 心电云平台检查信息 API
  version: 1.0.1
  title: 心电云平台检查信息 API
  contact:
    email: xuwei@aecg.com.cn
  license:
    name: Copyright
    url: 'http:/www.aecg.com.cn'
host: localhost:3001
basePath: '/v1'
tags:
  - name: Examination
    description: 检查信息
consumes:
  - application/json
produces:
  - application/json

schemes:
  - http
paths:
  '/reservations':
    get:
      tags:
        - Reservation
      summary: 获取预约单列表（√）
      description: ''
      operationId: findReservations
      parameters:
        - name: X-Access-Token
          in: header
          description: 鉴权token
          required: true
          type: string
        - name: lastSyncTime
          in: query
          description: 上次同步时间
          required: true
          type: string
          format: date
        - name: pagination
          in: query
          description: Pagination实体类分页信息
          type: string
      responses:
        '200':
          description: 获取检查信息成功
          schema:
            $ref: '#/definitions/ReservationPagerResponse'
            
    post:
      tags:
        - Reservation
      summary: 新增预约单信息(√)
      description: ''
      operationId: createReservation
      parameters:
        - name: X-Access-Token
          in: header
          description: 鉴权token
          required: true
          type: string
        - in: body
          name: body
          description: 需要新增的检查信息
          required: true
          schema:
            type: object
            $ref: '#/definitions/PatientInfo'
      responses:
        '200':
          description: 新增预约单信息
          schema:
              properties:
                serverReservationId:
                  type: object
                  description: 预约单主键
                  
    put:
      tags:
        - Reservation
      summary: 编辑预约单信息(√)
      description: ''
      operationId: updateReservation
      parameters:
        - name: X-Access-Token
          in: header
          description: 鉴权token
          required: true
          type: string
        - in: body
          name: body
          description: 需要新增的检查信息
          required: true
          schema:
            allOf:
            - $ref: "#/definitions/PatientInfo"
            - type: object
              properties:
                serverReservationId:
                  type: integer
                  description: 主键
      responses:
        '200':
          description: 修改预约单信息
          schema:
              properties:
                serverReservationId:
                  type: object
                  description: 预约单主键
                  
  '/reservations/{id}/detail':
    get:
      tags:
        - Reservation
      summary: 获取预约单(√)
      operationId: getReservationById
      parameters:
        - name: X-Access-Token
          in: header
          description: 鉴权token
          required: true
          type: string
        - in: path
          name: id
          description: 预约单id
          required: true
          type: string
      responses:
        200:
          description: 获取预约单
          schema:
            allOf:
            - $ref: "#/definitions/PatientInfo"
            - type: object
              properties:
                serverReservationId:
                  type: integer
                  description: 主键

  '/reservations/{id}':
    delete:
      tags:
        - Reservation
      summary: 删除预约单(√)
      operationId: deleteReservation
      parameters:
        - name: X-Access-Token
          in: header
          description: 鉴权token
          required: true
          type: string
        - in: path
          name: id
          description: 预约单id
          required: true
          type: string
      responses:
        200:
          description: 预约单删除成功
          schema:
            $ref: 'http://apispec.aecg.com.cn/schemas/common.yaml#/definitions/Response'
            
  '/examinations':
    get:
      tags:
        - Examination
      summary: 获取检查信息列表（√）
      description: ''
      operationId: findExaminations
      parameters:
        - name: X-Access-Token
          in: header
          description: 鉴权token
          required: true
          type: string
        - name: lastSyncTime
          in: query
          description: 上次同步时间
          required: true
          type: string
          format: date
        - name: pagination
          in: query
          description: Pagination实体类分页信息
          type: string
      responses:
        '200':
          description: 获取检查信息成功
          schema:
            $ref: '#/definitions/ExaminationPagerResponse'
    post:
      tags:
        - Examination
      summary: 新增检查信息(√)
      description: ''
      operationId: createExamination
      parameters:
        - name: X-Access-Token
          in: header
          description: 鉴权token
          required: true
          type: string
        - in: body
          name: body
          description: 需要新增的检查信息
          required: true
          schema:
            type: object
            $ref: '#/definitions/Examination'
      responses:
        '200':
          description: 新增检查信息成功
          schema:
              properties:
                serverExamId:
                  type: integer
                  description: 主键
    put:
      tags:
        - Examination
      summary: 修改检查信息（√）
      description: ''
      operationId: updateExamination
      parameters:
        - name: X-Access-Token
          in: header
          description: 鉴权token
          required: true
          type: string
        - in: body
          name: body
          description: 需要修改的检查信息
          required: true
          schema:
            type: array
            items:
              $ref: '#/definitions/ExaminationDetailResponse'
      responses:
        '200':
          description: 更新检查信息成功
          schema:
            $ref: 'http://apispec.aecg.com.cn/schemas/common.yaml#/definitions/Response'

  '/examinations/{id}':
    get:
      tags:
        - Examination
      summary: 获取检查详细信息(√)
      description: Multiple status values can be provided with comma separated strings
      operationId: getExaminationById
      parameters:
        - name: X-Access-Token
          in: header
          description: 鉴权token
          required: true
          type: string
        - name: id
          in: path
          description: 检查id
          required: true
          type: string
      responses:
        '200':
          description: 获取检查信息成功
          schema:
            $ref: '#/definitions/ExaminationDetailResponse'

  '/examinations/{id}/apply-diagnosis':
    post:
      tags:
        - Examination
      summary: 申请诊断（√）
      description: 诊断医生提出申请诊断
      operationId: applyDiagnosis
      parameters:
        - name: X-Access-Token
          in: header
          description: 鉴权token
          required: true
          type: string
        - name: id
          in: path
          description: 检查id
          required: true
          type: string
      responses:
        '200':
          description: 申请诊断成功
          schema:
            $ref: 'http://apispec.aecg.com.cn/schemas/common.yaml#/definitions/Response'

  '/examinations/{id}/reject-diagnosis':
    post:
      tags:
        - Examination
      summary: 退回诊断（√）
      description: 退回诊断
      operationId: rejectDiagnosis
      parameters:
        - name: X-Access-Token
          in: header
          description: 鉴权token
          required: true
          type: string
        - name: id
          in: path
          description: 检查id
          required: true
          type: string
      responses:
        '200':
          description: 退回诊断成功
          schema:
            $ref: 'http://apispec.aecg.com.cn/schemas/common.yaml#/definitions/Response'

  '/examinations/{id}/diagnose':
    post:
      tags:
        - Examination
      summary: 提交诊断信息（√）
      description: 诊断医生提交诊断信息
      operationId: diagnose
      parameters:
        - name: X-Access-Token
          in: header
          description: 鉴权token
          required: true
          type: string
        - name: id
          in: path
          description: 检查id
          required: true
          type: string
        - in: body
          name: body
          description: 诊断信息
          required: true
          schema:
            type: object
            $ref: '#/definitions/CompleteReportInfo'
      responses:
        '200':
          description: 申请诊断信息
          schema:
            $ref: 'http://apispec.aecg.com.cn/schemas/common.yaml#/definitions/Response'

  '/examinations/{id}/publish':
    post:
      tags:
        - Examination
      summary: 申请会诊（√）
      description: ''
      operationId: publishExamination
      parameters:
        - name: X-Access-Token
          in: header
          description: 鉴权token
          required: true
          type: string
        - in: path
          name: id
          description: 检查唯一表示
          required: true
          type: string
      responses:
        '200':
          description: 申请会诊成功
          schema:
            $ref: 'http://apispec.aecg.com.cn/schemas/common.yaml#/definitions/Response'

  '/examinations/{id}/urgent':
    post:
      tags:
        - Examination
      summary: 加急检查（√）
      description: ''
      operationId: urgentExamination
      parameters:
        - name: X-Access-Token
          in: header
          description: 鉴权token
          required: true
          type: string
        - in: path
          name: id
          description: 检查 id
          required: true
          type: string
        - in: query
          name: type
          description: 加急类型
          type: string
          enum: ['normal', 'chestpain']

      responses:
        '200':
          description: successful operation
          schema:
            $ref: 'http://apispec.aecg.com.cn/schemas/common.yaml#/definitions/Response'

  '/examinations/{id}/print':
    post:
      tags:
        - Examination
      summary: 上报打印状态（√）
      description: ''
      operationId: printExamination
      parameters:
        - name: X-Access-Token
          in: header
          description: 鉴权token
          required: true
          type: string
        - in: path
          name: id
          description: 检查id
          required: true
          type: string
      responses:
        '200':
          description: 上报状态成功
          schema:
            $ref: 'http://apispec.aecg.com.cn/schemas/common.yaml#/definitions/Response'
            
  '/examinations/{id}/take':
    post:
      tags:
        - Examination
      summary: 上报取回（√）
      description: ''
      operationId: takeExamination
      parameters:
        - name: X-Access-Token
          in: header
          description: 鉴权token
          required: true
          type: string
        - in: path
          name: id
          description: 检查id
          required: true
          type: string
      responses:
        '200':
          description: 上报状态成功
          schema:
            $ref: 'http://apispec.aecg.com.cn/schemas/common.yaml#/definitions/Response'
            
  '/examinations/{id}/ecg-atlas':
    get:
      tags:
        - ECG
      summary: 获取检查心电图谱数据（√）
      operationId: getEcg
      parameters:
      - name: X-Access-Token
        in: header
        description: 鉴权token
        required: true
        type: string
      - name: id
        in: path
        description: 获取心电图数据
        type: string
        required: true
      responses:
        200:
          description: 获取心电数据
          schema:
            type: object
            properties:
              atlases:
                type: array
                items:
                  $ref: '#/definitions/EcgAtlaseDetail'

  '/examinations/{id}/ecg-atlases':
    post:
      tags:
        - Examination
      summary: 为检查信息关联一个图谱（√）
      operationId: createExaminationAtlas
      parameters:
        - name: X-Access-Token
          in: header
          description: 鉴权token
          required: true
          type: string
        - in: path
          name: id
          description: 服务端返回的检查id
          required: true
          type: string
        - in: body
          name: body
          description: 心电图信息
          required: true
          schema:
            type: object
            $ref: '#/definitions/EcgAtlase'
      responses:
        200:
          description: 检查信息关联成功
          schema:
            type: object
            properties:
              data:
                type: object
                $ref: '#/definitions/EcgAtlaseResponse'


  '/examinations/{id}/ecg-atlases/{atlasId}':
    delete:
      tags:
        - Examination
      summary: 为检查信息解除关联图谱(√)
      operationId: deleteExaminationAtlas
      parameters:
        - name: X-Access-Token
          in: header
          description: 鉴权token
          required: true
          type: string
        - in: path
          name: id
          description: 检查id
          required: true
          type: string
        - in: path
          name: atlasId
          type: string
          description: 图谱id
          required: true
      responses:
        200:
          description: 检查信息解除关联成功
          schema:
            $ref: 'http://apispec.aecg.com.cn/schemas/common.yaml#/definitions/Response'
definitions:
  ExaminationCreationResponse:
    description: 检查信息创建响应
    allOf:
      - $ref: 'http://apispec.aecg.com.cn/schemas/common.yaml#/definitions/Response'
      - type: object
        properties:
          examId:
            $ref: 'http://apispec.aecg.com.cn/schemas/ecgcloud/examination.yaml#/definitions/Examination/properties/id'

  ExaminationListResponse:
    description: 检查信息列表响应
    allOf:
      - $ref: 'http://apispec.aecg.com.cn/schemas/common.yaml#/definitions/Response'
      - type: object
        properties:
          data:
            type: array
            items:
              $ref: '#/definitions/Examination'

  ExaminationResponse:
    description: 检查信息详情
    allOf:
      - $ref: 'http://apispec.aecg.com.cn/schemas/common.yaml#/definitions/Response'
      - type: object
        properties:
          data:
            $ref: '#/definitions/Examination'

  Examination:
    type: object
    description: 检查信息
    properties:
      clientExamId:
        type: string
        description: 客户端检查的Id 64 必传
      examType:
        type: integer
        description: 检查类型（常规心电1001、动态心电1002、动态血压1003）
      clinicalInfo:
        description: 临床信息
        $ref: '#/definitions/ClinicalInfo'
      patientInfo:
        description: 病人信息
        $ref: '#/definitions/PatientInfo'
        
  CompleteReportInfo:
    type: object
    description: 报告完成信息
    properties:
      serverExamId:
        type: integer
        description: 服务端检查主键
      diagnoseDate:
        type: string
        description: 诊断时间
      description:
        type: string
        description: 报告描述（512字符内）
      diagnose:
        type: string
        description: 报告诊断（512字符内，必填）
      extendJson:
        type: string
        description: 业务特有字段

        
  EcgAtlase:
    type: object
    description: 心电检查图谱信息
    properties:
      serverExamId:
        type: integer
        description: 服务端检查主键
      clientExamId:
        type: string
        description: 客户端检查ID 64 必传
      clientAcquisitionId:
        type: string
        description: 客户端采集ID 64 必传
      hashCode:
        type: string
        description: 文件Hash值 128 必传
      name:
        type: string
        description: 文件名 256 必传
      fileUri:
        type: string
        description: OSS或文件存储上的文件Uri 512 必传
      size:
        type: integer
        description: 文件大小（B）
      order:
        type: integer
        description: 当前文件顺序
      duration:
        type: integer
        description: 采集时长
      examType:
        type: integer
        description: 检查类型（常规心电1001、动态心电1002、动态血压1003）
      ecgFileType:
        type: integer
        description: 文件格式、HL7（1）、NB（2）格式
      leadNameList:
        type: string
        description: 导联名称形如[I,II,III]
      avm:
        type: number
        description: 灵敏度
      samplePerSecond:
        type: integer
        description: 采样率
      remark:
        type: string
        description: 备注
      extendJson:
        type: string
        description: 业务特有字段
        
        
  EcgAtlaseDetail:
    type: object
    description: 心电检查图谱信息
    properties:
      serverExamId:
        type: integer
        description: 服务端检查主键
      clientExamId:
        type: string
        description: 客户端检查ID 64 必传
      ServerAcquisitionId:
        type: integer
        description: 服务端采集ID
      clientAcquisitionId:
        type: string
        description: 客户端采集ID 
      hashCode:
        type: string
        description: 文件Hash值 
      name:
        type: string
        description: 文件名 
      fileUri:
        type: string
        description: OSS或文件存储上的文件Uri 
      size:
        type: integer
        description: 文件大小（B）
      order:
        type: integer
        description: 当前文件顺序
      duration:
        type: integer
        description: 采集时长
      examType:
        type: integer
        description: 检查类型（常规心电1001、动态心电1002、动态血压1003）
      ecgFileType:
        type: integer
        description: 文件格式、HL7（1）、NB（2）格式
      leadNameList:
        type: string
        description: 导联名称形如[I,II,III]
      avm:
        type: number
        description: 灵敏度
      samplePerSecond:
        type: integer
        description: 采样率
      remark:
        type: string
        description: 备注
      extendJson:
        type: string
        description: 业务特有字段
        
  EcgAtlaseResponse:
    description: 图谱新增返回
    allOf:
      - $ref: 'http://apispec.aecg.com.cn/schemas/common.yaml#/definitions/Response'
      - type: object
        properties:
         data:
          type: object
          properties:
            serverEcgAtlaseId:
              type: integer
            
  ClinicalInfo:
    type: object
    description: 临床信息
    properties:
      uSCI:
        type: string
        description: 检查机构统一社会信用代码
      orgCode:
        type: string
        description: 检查机构组织机构代码
      orgName:
        type: string
        description: 检查机构名称
      examItem:
        type: string
        description: 检查项目
      applyDept:
        type: string
        description: 申请部门
      applyDoctorName:
        type: string
        description: 申请医生
      examDoctorCode:
        type: string
        description: 检查医生Code
      examDoctorName:
        type: string
        description: 检查医生
      examTime:
        type: string
        description: 检查时间
      hospitalNumber:
        type: string
        description: 住院号
      bedNumber:
        type: string
        description: 床号
      wardName:
        type: string
        description: 病区
      deviceCode:
        type: string
        description: 设备Code
      deviceName:
        type: string
        description: 设备名称
      medicalHistory:
        type: string
        description: 病史
      clinicalDiagnosis:
        type: string
        description: 临床诊断
      extendJson:
        type: string
        description: 业务特有字段
        
  PatientInfo:
    type: object
    description: 病人信息
    properties:
      name:
        type: string
        description: 姓名
      englishName:
        type: string
        description: 英文名
      pinyin:
        type: string
        description: 拼音
      pinyinShort:
        type: string
        description: 拼音缩写
      pinyinInitial:
        type: string
        description: 拼音首字母
      gender:
        type: string
        description: 性别（1 男 2女 9 未知）
      age:
        type: string
        description: 年龄
      identityCard:
        type: string
        description: 身份证号码
      birthdate:
        type: string
        description: 出生日期
      height:
        type: integer
        description: 身高（厘米）
      weight:
        type: number
        description: 体重（千克）
      nation:
        type: string
        description: 民族
      address:
        type: string
        description: 家庭住址
      contact:
        type: string
        description: 联系方式
      wechatNumber:
        type: string
        description: 微信号
      extendJson:
        type: string
        description: 业务特有字段
  
  ExaminationDetailResponse:
      type: object
      description: 检查详情
      properties:
        serverExamId:
          type: integer
          description: 检查的Id 
        clientExamId:
          type: string
          description: 客户端检查的Id 
        examType:
          type: integer
          description: 检查类型（常规心电1001、动态心电1002、动态血压1003）
        status:
          type: integer
          description: 状态
        clinicalInfo:
          description: 临床信息
          $ref: '#/definitions/ClinicalInfo'
        patientInfo:
          description: 病人信息
          $ref: '#/definitions/PatientInfo'
        applyInfo:
          description: 申请信息
          $ref: '#/definitions/ApplyDetail'
        diagnoseInfo:
          description: 诊断信息
          $ref: '#/definitions/DiagnoseDetail'
        urgentInfo:
          description: 加急信息
          $ref: '#/definitions/UrgentDetail'  
  ApplyDetail:
    type: object
    description: 受理信息
    properties:
      applyUserId:
        type: string
        description: 受理人ID
      applyUserName:
        type: string
        description: 受理人
      applyTime:
        type: string
        description: 受理时间
        
  UrgentDetail:
    type: object
    description: 加急信息
    properties:
      urgentType:
        type: string
        description: 加急类型（枚举）
      urgentTime:
        type: string
        description: 加急时间
        
  DiagnoseDetail:
    type: object
    description: 诊断信息
    properties:
      diagnoseUserId:
        type: string
        description: 诊断人Id
      diagnoseUserName:
        type: string
        description: 诊断人名称
      diagnoseDate:
        type: string
        description: 诊断时间
      description:
        type: string
        description: 报告描述
      diagnose:
        type: string
        description: 报告诊断
      extendJson:
        type: string
        description: 业务特有字段
      lastTakeTime:
        type: string
        description: 取回时间
      lastPrintTime:
        type: string
        description: 取回时间
      
  SearchCondition:
    type: object
    description: 查询条件
    properties:
      key:
        type: string
        description: 查询的列名
      value:
        type: string
        description: 查询的值

  OrderCondition:
    type: object
    description: 排序条件
    properties:
      key:
        type: string
        description: 排序列名
      isAsc:
        type: boolean
        description: 是否升序排列
  
  Pagination:
    type: object
    description: 分页条件
    properties:
      page:
        type: integer
        description: 当前第几页
      pageSize:
        type: integer
        description: 每页显示多少条
      searchConditions:
        description: 查询条件
        type: array
        items:
          $ref: '#/definitions/SearchCondition' 
      orderConditions:
        description: 排序条件
        type: array
        items:
          $ref: '#/definitions/OrderCondition' 
          
          
  ExaminationPagerRow:
    type: object
    description: 分页详情
    properties:
      serverExamId:
        type: integer
        description: 服务端检查Id
      orgName:
        type: string
        description: 检查机构名称
      examItem:
        type: string
        description: 检查项目
      examDoctorName:
        type: string
        description: 检查医生
      deviceCode:
        type: string
        description: 设备Code
      deviceName:
        type: string
        description: 设备名称
      patName:
        type: string
        description: 病人姓名
      identityCard:
        type: string
        description: 身份证号码
      gender:
        type: integer
        description: 性别
      examType:
        type: integer
        description: 检查类型（常规心电1001、动态心电1002、动态血压1003）
      examTime:
        type: string
        description: 检查时间
      status:
        type: integer
        description: 状态
      applyUserName:
        type: string
        description: 受理人
      applyTime:
        type: string
        description: 受理时间
      urgentType:
        type: string
        description: 加急类型（枚举）
      urgentTime:
        type: string
        description: 加急时间
      diagnoseUserName:
        type: string
        description: 诊断人名称
      diagnoseDate:
        type: string
        description: 诊断时间
      lastTakeTime:
        type: string
        description: 取回时间
          
  ExaminationPagerResponse:
    type: object
    description: 分页返回
    properties:
      totalCount:
        type: integer
        description: 总条数
      pageCount:
        type: integer
        description: 总页数
      rows:
        type: array
        items:
          $ref: '#/definitions/ExaminationPagerRow' 
          
  ReservationPagerResponse:
    type: object
    description: 分页返回
    properties:
      totalCount:
        type: integer
        description: 总条数
      pageCount:
        type: integer
        description: 总页数
      rows:
        type: array
        description: 列表详情
        items:
          allOf:
            - $ref: "#/definitions/PatientInfo"
            - type: object
              properties:
                serverReservationId:
                  type: integer
                  description: 主键